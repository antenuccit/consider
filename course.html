{% extends "admin_base.html" %}
{% block title %}Admin{% endblock %}

{% block content %}
<h1 class="page-header">Courses and Sections</h1>
<button class="btn btn-default" onclick="addCourse()">Add a course</button>
<h4 class="sub-header">Current courses {% if courses -%} ({{courses|length}}) {%- endif -%}:</h4>
{% if courses %}
<div class="table-responsive">
    <table class="table table-striped">
        <thead>
        <tr>
            <th>#</th>
            <th>Course Name</th>
            <th>Status</th>
            <th>Toggle</th>
        </tr>
        </thead>
        <tbody>
        {% for course in courses %}
        <tr>
            <td>{{loop.index}}</td>
            <td>{{course.name}}</td>
            <td>{%- if course.is_active -%}Active{%- else -%}Inactive{%- endif -%}</td>
            <td>{% if course.is_active %}
                <button class="btn btn-danger btn-sm" onclick="toggleStatus('{{course.name}}')">Inactivate
                </button>
                {% else %}
                <button class="btn btn-success btn-sm" onclick="toggleStatus('{{course.name}}')">Activate
                </button>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<p>No courses added.</p>
{% endif %}
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">Please add a Course</h4>
            </div>
            <div class="modal-body">
                <form class="form-horizontal" id="modalForm" method="post" style="text-align: center;" action="/add_course">
                    <div class="form-group">
                        <label for="courseName" class="col-sm-4 control-label">Course Name:</label>

                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="courseName" name="courseName"
                                   placeholder="Ex: CSE123-AU15" required>
                        </div>
                    </div>
                    <button type="submit" class="hide"></button>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="submitCourse()">Add Course</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block script %}
<script>
    $("#modalForm").submit(function (event) {
        //Prevent the default behaviour
        event.preventDefault();

        //collect form elements
        var $form = $(this),
                courseName = $('#courseName').val(),
                url = $form.attr("action");

        bootbox.confirm("Are you sure, you want to add " + courseName + " ?", function (result) {
            if (result) {
                // do the POST and get the callback
                $.post(url, {name: courseName}, function (data) {
                    bootbox.alert(data, function () {
                        location.reload();
                    });
                });
            }
        });
    });

    $(document).ready(function () {
        $('#courseName').tooltip({'trigger': 'focus', 'title': 'Course name should be unique'});
    });

    function submitCourse() {
        $("#modalForm").find('[type="submit"]').trigger('click');
    }

    function addCourse() {
        $("#myModal").modal('show');
    }
</script>
{% endblock %}